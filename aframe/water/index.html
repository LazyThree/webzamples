<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://threejs.org/examples/js/objects/Refractor.js"></script>
    <script src="https://threejs.org/examples/js/objects/Reflector.js"></script>
    <script src="https://threejs.org/examples/js/objects/Water2.js"></script>
    <script>
        AFRAME.registerComponent("water", {
            init: function() {
                let mesh;
                let waterObj;
                this.el.addEventListener("loaded", evt => {
                    const mesh = this.el.getObject3D("mesh");
                    waterObj = new THREE.Water(new THREE.BufferGeometry().copy(mesh.geometry), {
                                                color: "#ffffff",
                                                scale: 1,
                                                flowDirection: new THREE.Vector2(1, 1),
                                                textureWidth: 1024,
                                                textureHeight: 1024});
                    mesh.visible = false;
                    // attach just for the sake of attaching, it could be 'add' as well
                    waterObj.position.copy(this.el.object3D.position)
                    waterObj.rotation.copy(this.el.object3D.rotation)
                    this.el.object3D.attach(waterObj);
                    
                })
             }
            
        })

    </script>
  </head>
  <body>
          <!-- info + CREDITS -->
    <div style='position: fixed; width:100%; text-align: center; z-index: 1; left: 0;
    right: 0; background-color:blanchedalmond;'>
    <h3>THREE.Water with a-frame</h3>
    <a href="https://github.com/mrdoob/three.js/blob/master/examples/webgl_water.html">THREE.js water example</a><br>
    <a href="https://en.wikipedia.org/wiki/Panorama#/media/File:SonyCenter_360panorama.jpg">panorama</a><a href="https://creativecommons.org/licenses/by-sa/3.0/">(CC 3.0)</a>
    <br>
    Source code <a href="https://github.com/gftruj/webzamples/tree/master/aframe/water/index.html">here</a>
    </div>
    <a-scene>
      <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
      <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
      <a-plane position="0 0 -4" rotation="-90 0 0" width="20" height="20" color="#7BC8A4" 
      water material="color: white; transparent: true; opacity: 0.0"></a-plane>
      <a-sky material="src: https://upload.wikimedia.org/wikipedia/commons/6/65/SonyCenter_360panorama.jpg"></a-sky>
    </a-scene>
  </body>
</html>